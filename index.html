<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reservas da Frota — Núcleo Estratégico</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://alcdn.msauth.net/browser/2.38.3/js/msal-browser.min.js"></script>
  <style>
    :root{
      --brand-primary: #0a4b3e; /* Unicred verde aproximado */
      --brand-accent:  #c7a440; /* Unicred dourado aproximado */
    }
    body{ background:#ffffff; color:#0b0f12; }
    .header{ border-bottom:1px solid #e5e7eb; }
    .brand-title{ color: var(--brand-primary); }
    .btn{ padding:.5rem .75rem; border:1px solid #d1d5db; border-radius:.5rem; background:#fff; }
    .btn:hover{ background:#f9fafb; }
    .btn-primary{ background: var(--brand-primary); color:#fff; border-color: var(--brand-primary); }
    .btn-danger{ background:#ef4444; color:#fff; border-color:#ef4444; }
    .card{ background:#fff; border:1px solid #e5e7eb; border-radius: .75rem; }
    .input, .select{ width:100%; padding:.5rem .75rem; border-radius:.5rem; background:#fff; border:1px solid #d1d5db; color:#111827; }
    .muted{ color:#6b7280; }
    .pill{ background: var(--brand-accent); color:#fff; border-radius:9999px; padding:.15rem .5rem; font-size:.75rem; }
    .banner { max-height: 60px; width: auto; }
    .footer-banner { max-height: 90px; width: auto; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    const { useState, useMemo } = React;
    const VEHICLES=[
      { id:"virtus_cinza", nome:"Virtus Cinza", placa:"RYD2D70" },
      { id:"virtus_preto", nome:"Virtus Preto", placa:"RYD2B90" },
    ];
    const LS_KEY="fleet-bookings-v1";
    const load=()=>{ try{return JSON.parse(localStorage.getItem(LS_KEY)||"[]")}catch{return[]} };
    const save=(rows)=>localStorage.setItem(LS_KEY, JSON.stringify(rows));
    function overlaps(aStart,aEnd,bStart,bEnd){return (new Date(aStart)<new Date(bEnd))&&(new Date(bStart)<new Date(aEnd));}

    const MS_CONFIG = { clientId: "", tenantId: "" };
    const msalInstance = (MS_CONFIG.clientId && MS_CONFIG.tenantId)
      ? new msal.PublicClientApplication({ auth: { clientId: MS_CONFIG.clientId, authority: `https://login.microsoftonline.com/${MS_CONFIG.tenantId}`, redirectUri: window.location.origin } })
      : null;
    async function msLogin(){ if(!msalInstance){ alert("Login Microsoft não configurado."); return; } try{ const res=await msalInstance.loginPopup({scopes:['User.Read']}); return res.account; }catch(e){ alert('Falha no login: '+e.message);} }
    async function msLogout(){ if(!msalInstance) return; const acc=msalInstance.getActiveAccount(); if(acc) await msalInstance.logoutPopup({account:acc}); else await msalInstance.logoutPopup(); }

    function App(){
      const [reservas,setReservas]=useState(load());
      const [form,setForm]=useState({
        id:crypto.randomUUID(),
        veiculoId:VEHICLES[0].id,
        destino:"",
        motorista:"",
        inicio:new Date(Date.now()-new Date().getTimezoneOffset()*60000).toISOString().slice(0,16),
        fim:new Date(Date.now()+60*60*1000-new Date().getTimezoneOffset()*60000).toISOString().slice(0,16)
      });
      const [user,setUser]=useState(null);

      function u(k,v){ setForm(p=>({...p,[k]:v})); }
      function hasConflict(c){ return reservas.some(r=>r.id!==c.id && r.veiculoId===c.veiculoId && overlaps(r.inicio,r.fim,c.inicio,c.fim)); }
      function salvar(){
        const r={...form, inicio:new Date(form.inicio).toISOString(), fim:new Date(form.fim).toISOString(), motorista: form.motorista || (user?.name || user?.username || "") };
        if(new Date(r.fim)<=new Date(r.inicio)){ alert("Fim deve ser depois do início."); return; }
        if(hasConflict(r)){ alert("Conflito detectado para este veículo no período."); return; }
        const next=[...reservas,r]; setReservas(next); save(next);
        setForm({ id:crypto.randomUUID(), veiculoId:VEHICLES[0].id, destino:"", motorista:"", inicio:new Date(Date.now()-new Date().getTimezoneOffset()*60000).toISOString().slice(0,16), fim:new Date(Date.now()+60*60*1000-new Date().getTimezoneOffset()*60000).toISOString().slice(0,16) });
      }
      function excluir(id){ if(!confirm("Remover reserva?"))return; const next=reservas.filter(r=>r.id!==id); setReservas(next); save(next); }
      const ordered=useMemo(()=>reservas.slice().sort((a,b)=>new Date(a.inicio)-new Date(b.inicio)),[reservas]);
      function fmt(x){ const d=new Date(x); return d.toLocaleDateString('pt-BR')+' '+d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}); }

      return React.createElement('div', {className:'max-w-6xl mx-auto p-4 md:p-8 space-y-6'}, [
        // Header com banner à esquerda do título
        React.createElement('div',{key:'hdr',className:'header flex items-center justify-between py-3'},[
          React.createElement('div',{key:'left',className:'flex items-center gap-4'},[
            React.createElement('img',{key:'banner', className:'banner', src:'./header-banner.png', alt:'UNICRED'}),
            React.createElement('div',{key:'tt'},[
              React.createElement('div',{className:'text-xl font-bold brand-title'},'Núcleo Estratégico'),
              React.createElement('div',{className:'text-sm muted'},'Reservas de veículos')
            ])
          ]),
          React.createElement('div',{key:'right',className:'flex items-center gap-2'},[
            msalInstance
              ? (user
                  ? React.createElement('div',{className:'flex items-center gap-2'},[
                      React.createElement('span',{className:'pill'}, user.name || user.username),
                      React.createElement('button',{className:'btn', onClick:()=>{msLogout().then(()=>setUser(null));}},'Sair')
                    ])
                  : React.createElement('button',{className:'btn', onClick:()=>{msLogin().then(acc=>acc && setUser({ name: acc.name, username: acc.username }));}},'Entrar com Microsoft'))
              : null
          ])
        ]),

        // Form
        React.createElement('div',{key:'form',className:'card p-4'},[
          React.createElement('h2',{className:'text-lg font-semibold mb-3'},'Nova reserva'),
          React.createElement('div',{className:'grid grid-cols-1 md:grid-cols-2 gap-3'},[
            React.createElement('div',null,[React.createElement('div',{className:'text-sm muted mb-1'},'Veículo'),
              React.createElement('select',{className:'select',value:form.veiculoId,onChange:e=>u('veiculoId',e.target.value)},
                VEHICLES.map(v=>React.createElement('option',{key:v.id,value:v.id},v.nome+' • '+v.placa))) ]),
            React.createElement('div',null,[React.createElement('div',{className:'text-sm muted mb-1'},'Motorista'),
              React.createElement('input',{className:'input',value:form.motorista,onChange:e=>u('motorista',e.target.value),placeholder:'Nome do condutor'}) ]),
            React.createElement('div',{className:'md:col-span-2'},[React.createElement('div',{className:'text-sm muted mb-1'},'Destino'),
              React.createElement('input',{className:'input',value:form.destino,onChange:e=>u('destino',e.target.value),placeholder:'Cidade / órgão / reunião'}) ]),
            React.createElement('div',null,[React.createElement('div',{className:'text-sm muted mb-1'},'Data e hora (início)'),
              React.createElement('input',{type:'datetime-local',className:'input',value:form.inicio,onChange:e=>u('inicio',e.target.value)}) ]),
            React.createElement('div',null,[React.createElement('div',{className:'text-sm muted mb-1'},'Data e hora (fim)'),
              React.createElement('input',{type:'datetime-local',className:'input',value:form.fim,onChange:e=>u('fim',e.target.value)}) ]),
            React.createElement('div',{className:'md:col-span-2 text-right'},[
              React.createElement('button',{className:'btn btn-primary',onClick:salvar},'Salvar reserva')
            ])
          ])
        ]),

        // Lista
        React.createElement('div',{key:'list',className:'card p-4'},[
          React.createElement('h2',{className:'text-lg font-semibold mb-3'},'Reservas'),
          ordered.length===0
            ? React.createElement('div',{className:'muted'},'Sem reservas')
            : React.createElement('table',{className:'w-full text-sm'},[
                React.createElement('thead',null,
                  React.createElement('tr',null,[
                    React.createElement('th',{className:'text-left p-2'},'Início'),
                    React.createElement('th',{className:'text-left p-2'},'Fim'),
                    React.createElement('th',{className:'text-left p-2'},'Veículo'),
                    React.createElement('th',{className:'text-left p-2'},'Motorista'),
                    React.createElement('th',{className:'text-left p-2'},'Destino'),
                    React.createElement('th',{className:'text-right p-2'},'Ações'),
                  ])
                ),
                React.createElement('tbody',null,
                  ordered.map(r=>{
                    const v=VEHICLES.find(x=>x.id===r.veiculoId);
                    return React.createElement('tr',{key:r.id,style:{borderTop:'1px solid #e5e7eb'}},[
                      React.createElement('td',{className:'p-2'},fmt(r.inicio)),
                      React.createElement('td',{className:'p-2'},fmt(r.fim)),
                      React.createElement('td',{className:'p-2'},(v?.nome||'')+' • '+(v?.placa||'')),
                      React.createElement('td',{className:'p-2'},r.motorista),
                      React.createElement('td',{className:'p-2'},r.destino),
                      React.createElement('td',{className:'p-2 text-right'},
                        React.createElement('button',{className:'btn btn-danger',onClick:()=>excluir(r.id)},'Excluir')
                      ),
                    ]);
                  })
                )
              ])
        ]),

        // Footer com banner centralizado (sem textos extras)
        React.createElement('div',{key:'ftr', className:'py-6 flex justify-center'}, [
          React.createElement('img', { className:'footer-banner', src:'./footer-banner.png', alt:'UNICRED' })
        ])
      ]);
    }

    const root=ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
